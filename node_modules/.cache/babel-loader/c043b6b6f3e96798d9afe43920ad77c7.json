{"ast":null,"code":"/**\n * @license\n * Copyright 2022 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\nimport { util } from '@tensorflow/tfjs-core';\n\nfunction lowerBound(array, value) {\n  let left = 0;\n  let right = array.length;\n  let mid = 0;\n\n  while (left < right) {\n    mid = Math.floor((left + right) / 2);\n\n    if (array[mid] < value) {\n      left = mid + 1;\n    } else {\n      right = mid;\n    }\n  }\n\n  return right;\n}\n\nfunction upperBound(array, value) {\n  let left = 0;\n  let right = array.length;\n  let mid = 0;\n\n  while (left < right) {\n    mid = Math.floor((left + right) / 2);\n\n    if (array[mid] <= value) {\n      left = mid + 1;\n    } else {\n      right = mid;\n    }\n  }\n\n  return right;\n}\n\nexport function searchSortedImpl(sortedInputs, values, batchSize, numInputs, numValues, side) {\n  const output = util.getArrayFromDType('int32', batchSize * numValues);\n\n  for (let b = 0; b < batchSize; ++b) {\n    const sortedInputsSlice = sortedInputs.slice(b * numInputs, (b + 1) * numInputs);\n    const outputOffset = b * numValues;\n\n    for (let i = 0; i < numValues; ++i) {\n      output[outputOffset + i] = side === 'left' ? lowerBound(sortedInputsSlice, values[i + outputOffset]) : upperBound(sortedInputsSlice, values[i + outputOffset]);\n    }\n  }\n\n  return output;\n}","map":{"version":3,"sources":["../../../../../../tfjs-backend-cpu/src/kernels/SearchSorted_impl.ts"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;;AAeG;AAEH,SAAoB,IAApB,QAA+B,uBAA/B;;AAEA,SAAS,UAAT,CAAoB,KAApB,EAAuC,KAAvC,EAAoD;EAClD,IAAI,IAAI,GAAG,CAAX;EACA,IAAI,KAAK,GAAG,KAAK,CAAC,MAAlB;EACA,IAAI,GAAG,GAAG,CAAV;;EACA,OAAO,IAAI,GAAG,KAAd,EAAqB;IACnB,GAAG,GAAG,IAAI,CAAC,KAAL,CAAW,CAAC,IAAI,GAAG,KAAR,IAAiB,CAA5B,CAAN;;IACA,IAAI,KAAK,CAAC,GAAD,CAAL,GAAa,KAAjB,EAAwB;MACtB,IAAI,GAAG,GAAG,GAAG,CAAb;IACD,CAFD,MAEO;MACL,KAAK,GAAG,GAAR;IACD;EACF;;EACD,OAAO,KAAP;AACD;;AAED,SAAS,UAAT,CAAoB,KAApB,EAAuC,KAAvC,EAAoD;EAClD,IAAI,IAAI,GAAG,CAAX;EACA,IAAI,KAAK,GAAG,KAAK,CAAC,MAAlB;EACA,IAAI,GAAG,GAAG,CAAV;;EACA,OAAO,IAAI,GAAG,KAAd,EAAqB;IACnB,GAAG,GAAG,IAAI,CAAC,KAAL,CAAW,CAAC,IAAI,GAAG,KAAR,IAAiB,CAA5B,CAAN;;IACA,IAAI,KAAK,CAAC,GAAD,CAAL,IAAc,KAAlB,EAAyB;MACvB,IAAI,GAAG,GAAG,GAAG,CAAb;IACD,CAFD,MAEO;MACL,KAAK,GAAG,GAAR;IACD;EACF;;EACD,OAAO,KAAP;AACD;;AAED,OAAM,SAAU,gBAAV,CACF,YADE,EACwB,MADxB,EAC4C,SAD5C,EAEF,SAFE,EAEiB,SAFjB,EAEoC,IAFpC,EAEwD;EAC5D,MAAM,MAAM,GACR,IAAI,CAAC,iBAAL,CAAuB,OAAvB,EAAgC,SAAS,GAAG,SAA5C,CADJ;;EAEA,KAAK,IAAI,CAAC,GAAG,CAAb,EAAgB,CAAC,GAAG,SAApB,EAA+B,EAAE,CAAjC,EAAoC;IAClC,MAAM,iBAAiB,GACnB,YAAY,CAAC,KAAb,CAAmB,CAAC,GAAG,SAAvB,EAAkC,CAAC,CAAC,GAAG,CAAL,IAAU,SAA5C,CADJ;IAEA,MAAM,YAAY,GAAG,CAAC,GAAG,SAAzB;;IACA,KAAK,IAAI,CAAC,GAAG,CAAb,EAAgB,CAAC,GAAG,SAApB,EAA+B,EAAE,CAAjC,EAAoC;MAClC,MAAM,CAAC,YAAY,GAAG,CAAhB,CAAN,GAA2B,IAAI,KAAK,MAAT,GACvB,UAAU,CAAC,iBAAD,EAAoB,MAAM,CAAC,CAAC,GAAG,YAAL,CAA1B,CADa,GAEvB,UAAU,CAAC,iBAAD,EAAoB,MAAM,CAAC,CAAC,GAAG,YAAL,CAA1B,CAFd;IAGD;EACF;;EACD,OAAO,MAAP;AACD","sourcesContent":["/**\n * @license\n * Copyright 2022 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {TypedArray, util} from '@tensorflow/tfjs-core';\n\nfunction lowerBound(array: TypedArray, value: number) {\n  let left = 0;\n  let right = array.length;\n  let mid = 0;\n  while (left < right) {\n    mid = Math.floor((left + right) / 2);\n    if (array[mid] < value) {\n      left = mid + 1;\n    } else {\n      right = mid;\n    }\n  }\n  return right;\n}\n\nfunction upperBound(array: TypedArray, value: number) {\n  let left = 0;\n  let right = array.length;\n  let mid = 0;\n  while (left < right) {\n    mid = Math.floor((left + right) / 2);\n    if (array[mid] <= value) {\n      left = mid + 1;\n    } else {\n      right = mid;\n    }\n  }\n  return right;\n}\n\nexport function searchSortedImpl(\n    sortedInputs: TypedArray, values: TypedArray, batchSize: number,\n    numInputs: number, numValues: number, side: 'left'|'right'): TypedArray {\n  const output =\n      util.getArrayFromDType('int32', batchSize * numValues) as TypedArray;\n  for (let b = 0; b < batchSize; ++b) {\n    const sortedInputsSlice =\n        sortedInputs.slice(b * numInputs, (b + 1) * numInputs);\n    const outputOffset = b * numValues;\n    for (let i = 0; i < numValues; ++i) {\n      output[outputOffset + i] = side === 'left' ?\n          lowerBound(sortedInputsSlice, values[i + outputOffset]) :\n          upperBound(sortedInputsSlice, values[i + outputOffset]);\n    }\n  }\n  return output;\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}